services:
  code-assistant:
    network_mode: host
    platform: linux/amd64
    build:
      context: .
      dockerfile: code_assistant.Dockerfile
    image: code-assistant-image:latest
    stdin_open: true
    tty: true
    volumes:
      - code-assistant-data:/root # Persist home directory (Claude state, uv cache, credentials)
      - ./settings.json:/root/.claude/settings.json:ro # Read-only settings
      - ./CLAUDE.md:/root/.claude/CLAUDE.md:ro # Read-only Claude.md
      - /var/run/docker.sock:/var/run/docker.sock # Share docker daemon
    environment:
      - UV_PROJECT_ENVIRONMENT=.venv_code_assistant # Use a dedicated virtual environment
      - TESTCONTAINERS_HOST_OVERRIDE=host.docker.internal
      - TESTCONTAINERS_DOCKER_SOCKET_OVERRIDE=/var/run/docker.sock
    working_dir: /workspace
    command: claude

volumes:
  code-assistant-data:
    driver: local
